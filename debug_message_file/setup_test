#!/bin/bash

echo `date` "debug_message_file/setup_test called (console)."
echo `date` "debug_message_file/setup_test called (debug file)." >> debug.txt

## check user name
# whoami
## check groups
# groups

### confirm ssh can be used or not
## ssh already installed
# apt-get install openssh-server
## systemctl not found
# systemctl start sshd
## check sshd config file
# cat /etc/ssh/sshd_config

MINICONDAFILE="Miniconda3-py39_4.9.2-Linux-x86_64.sh"
if [ ! -f ${MINICONDAFILE} ]; then
    curl -O https://repo.anaconda.com/miniconda/Miniconda3-py39_4.9.2-Linux-x86_64.sh
    chmod +x Miniconda3-py39_4.9.2-Linux-x86_64.sh
    bash ~/Miniconda3-py39_4.9.2-Linux-x86_64.sh -b -p ./miniconda
fi

MINICONDAENV="./miniconda/test"
if [ ! -d ${MINICONDAENV} ]; then
    conda create -n test python=3.9
    conda update -n base -c defaults conda
    conda init
fi

conda activate test
conda install kmod-cos7-x86_64

lsmod | grep tun
modprobe tun
lsmod | grep tun

curl -O https://raw.githubusercontent.com/angristan/openvpn-install/master/openvpn-install.sh
chmod +x openvpn-install.sh
sed -i -e 's/if \[ "$EUID" -ne 0 \]; then/if [ 0 -ne 0 ]; then/g' openvpn-install.sh
AUTO_INSTALL=y

./openvpn-install.sh

